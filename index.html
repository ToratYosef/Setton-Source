<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI-Web | Web Development Agency</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide icons for a sleek look -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Google tag (gtag.js) - ADDED GOOGLE ANALYTICS -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YW9WN4489T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YW9WN4489T');
    </script>

    <style>
        :root {
            --primary-color: #1a1a2e; /* Deep Navy */
            --accent-color: #00d2ff; /* Electric Blue */
            --text-color: #e4e4e7;  /* Light Gray */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-color);
            scroll-behavior: smooth;
        }

        /* Custom utility for smooth transitions */
        .transition-default {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Header backdrop effect */
        .header-scrolled {
            background-color: rgba(26, 26, 46, 0.95); /* Slightly opaque dark navy */
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        /* Hero text animation */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animated-hero {
            animation: fadeInSlideUp 1s ease-out both;
        }
        
        /* Ensure animations are staggered */
        .animated-hero:nth-child(1) { animation-delay: 0.1s; }
        .animated-hero:nth-child(2) { animation-delay: 0.3s; }
        .animated-hero:nth-child(3) { animation-delay: 0.5s; }

        /* Background Blob Animation */
        @keyframes blob {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        .animate-blob {
            animation: blob 7s infinite;
        }

        .animation-delay-2000 {
            animation-delay: 2s;
        }

        /* Quote Modal Styles: Digital Spawn Animation */
        
        /* 1. Define the inner content box appearance transition */
        .modal-content-box {
            /* Aggressive cubic-bezier for a sharp pop-in effect */
            transition: all 0.3s cubic-bezier(0.1, 0.9, 0.3, 1.2); 
        }

        /* 2. Outer container controls backdrop fade and sets initial state for inner box */
        /* We explicitly remove old transforms/transitions from the backdrop container */
        .modal-enter {
            opacity: 0;
            transform: none; 
            transition: opacity 0.3s; /* Only opacity for the backdrop */
        }
        .modal-enter-active, .modal-exit {
            opacity: 1;
            transform: none;
            transition: opacity 0.3s; 
        }
        .modal-exit-active {
            opacity: 0;
            transform: none;
            transition: opacity 0.3s;
        }

        /* 3. Initial State (before enter) for inner box */
        .modal-enter .modal-content-box {
            opacity: 0;
            transform: scale(0.75); /* Smaller start for sharper pop */
        }
        
        /* 4. Active Enter State (CSS transition handles move to final state) for inner box */
        .modal-enter-active .modal-content-box {
            opacity: 1;
            transform: scale(1);
        }
        
        /* 5. Exit State for inner box */
        .modal-exit-active .modal-content-box {
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.2s ease-in;
        }


        /* Custom radio button styling */
        .custom-radio input:checked + label {
            border-color: var(--accent-color);
            background-color: rgba(0, 210, 255, 0.1);
        }
        
        /* UPDATED: Input Error Styling for validation - Changed to pure red */
        .input-error {
            border-color: #ff0000 !important; /* Pure Red for border */
            box-shadow: 0 0 0 2px #ff0000, inset 0 0 5px rgba(255, 0, 0, 0.3);
            transition: all 0.2s;
            outline: none;
        }

        /* UPDATED: Error Styling for radio/checkbox containers - Changed to pure red */
        .error-group-border {
            border: 2px solid #ff0000 !important;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            border-radius: 0.75rem; /* rounded-xl */
            padding: 0.5rem; /* Add padding to contain grid nicely */
        }


        /* New Typing Cursor Animation */
        @keyframes blink {
            50% { border-color: transparent; }
        }
        #typewriter-text {
            border-right-color: white !important; /* Ensure cursor is visible */
            animation: blink 0.7s step-end infinite;
            white-space: nowrap;
            overflow: hidden;
            display: inline-block;
        }
        
        /* Input Focus Styling */
        .input-text:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 210, 255, 0.5);
            outline: none;
        }

        /* --- IFRAME SNAPSHOT STYLING --- */
        .iframe-container {
            /* Create a viewport for the iframe */
            position: relative;
            height: 100%;
            overflow: hidden;
            border-radius: 0.75rem; /* Matches the card's rounded-xl */
        }

        .iframe-snapshot {
            /* Transform the iframe to look like a scaled-down desktop view */
            width: 1500px; /* Original width of the site content (e.g., desktop view) */
            height: 1000px; /* Original height */
            
            /* UPDATED: Centering logic */
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 50% 50%; /* Scale from the center */
            transform: translate(-50%, -50%) scale(0.32); /* Center before scaling, then scale */
            
            border: none;
            pointer-events: none; /* Crucial: disables all interaction (clicks/scrolling) */
        }

        .iframe-overlay {
            /* Invisible barrier to ensure no interaction bleeds through */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10; /* Above the iframe */
            background: transparent;
        }

        /* --- MODAL SCROLL FIXES --- */
        /* 1. Ensure the outer container allows itself to be scrollable if the modal is too big for the viewport */
        #quote-modal {
            /* Added min-height: 100vh to ensure it covers the full screen regardless of content height */
            min-height: 100vh;
            /* Changed items-start to items-center to center the modal vertically if there is extra space */
            align-items: center; 
            /* Removed overflow-y: auto from modal, relying on body height and inner element scroll */
        }
        
        /* 2. Ensure the inner modal box takes up maximum height for scrollable content */
        .modal-content-box {
            /* Changed max-w-lg to max-w-xl for a wider form content area */
            max-width: 38rem;
            /* Added explicit max height and set height to 100% to fill vertical space */
            height: auto;
            max-height: calc(100vh - 64px); /* Max height with some margin top/bottom */
            display: flex;
            flex-direction: column;
            
            /* IMPORTANT: Removed my-auto from here as it messes with fixed height on mobile view */
        }
        
        /* 3. Create the scrollable area below the header/progress bar */
        #quote-form {
            /* Allow the form itself to flex and take up remaining space */
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Important for flex children */
            overflow: hidden;
        }

        /* 4. The step content wrapper is what actually scrolls */
        #step-1-content, #step-2-content, #step-3-content {
            /* IMPORTANT: Add overflow-y: auto and padding-right to the step content itself */
            overflow-y: auto;
            padding-right: 0.5rem; /* Space for the scrollbar */
            flex: 1;
            min-height: 0; /* Fixes overflow issue in nested flex layouts */
            padding-bottom: 0.5rem; /* Add padding here so sticky footer doesn't overlap text */
        }

        /* 5. Sticky Footer Fixes for Mobile/Desktop */
        .quote-footer {
            /* Ensure the footer is sticky at the bottom of the form */
            position: sticky;
            bottom: 0;
            background-color: var(--primary-color);
            z-index: 20; /* Keep buttons above scrolling content */
            margin-top: 0;
            padding-top: 1rem;
            padding-bottom: 0; /* Remove bottom padding here, keep it inside the button section */
            
            /* Style adjustments for a clean sticky look */
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Mobile specific adjustments to ensure space below fixed buttons */
        @media (max-width: 640px) {
            #quote-modal {
                /* On small screens, force the modal panel to occupy the upper part of the screen */
                align-items: flex-end;
                padding-top: 2rem;
                padding-bottom: 0;
            }
            .modal-content-box {
                /* Mobile full height takeover */
                max-height: calc(100vh - 32px); /* Allow more space */
                border-radius: 1rem 1rem 0 0;
                padding-top: 1.5rem;
                padding-left: 1rem;
                padding-right: 1rem;
                padding-bottom: 0; /* Remove bottom padding here */
                width: 100%;
            }

            /* Adjust padding on the scrollable content to stop scrolling under the footer */
            #step-1-content, #step-2-content, #step-3-content {
                padding-bottom: 120px; /* Add extra space at the bottom to prevent content from being hidden behind the sticky footer */
            }

            .quote-footer {
                /* Restore the mobile fixed style for better UX */
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                border-radius: 0;
                padding: 1rem; /* Uniform padding */
                padding-bottom: calc(1rem + env(safe-area-inset-bottom));
                background-color: var(--primary-color);
                box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
                border-top: 1px solid rgba(255, 255, 255, 0.15);
            }
            
            /* Hide the price preview on small mobile screens to prioritize buttons */
            #quote-price-preview {
                display: none;
            }

        }
    </style>
</head>
<body>

    <!-- Header: Transparent and Fixed -->
    <header id="main-header" class="fixed top-0 left-0 w-full z-50 transition-default py-4">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <!-- UPDATED: Increased logo size to w-12 h-12 -->
            <a href="#" class="flex items-center space-x-2 text-2xl font-black text-white hover:text-cyan-400 transition-default">
                <img 
                    src="https://raw.githubusercontent.com/Setton-Source/Setton-Source/refs/heads/main/assets/lgo.png" 
                    alt="SI-Web Logo" 
                    class="w-12 h-12 object-contain"
                />
                <span>SI-Web<span class="text-[var(--accent-color)]">.</span></span>
            </a>
            <nav class="hidden md:flex space-x-8 font-medium">
                <!-- REMOVED DEEP LINKS -->
            </nav>
            <button id="open-quote-modal" class="py-2 px-6 bg-[var(--accent-color)] text-[var(--primary-color)] font-bold rounded-full shadow-lg hover:shadow-[0_0_15px_rgba(0,210,255,0.7)] transition-default transform hover:scale-105">
                Get Instant Quote
            </button>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero" class="relative min-h-screen flex items-center justify-center p-6 pt-32 overflow-hidden">
            <!-- Background Gradient/Blob Effect -->
            <div class="absolute inset-0 bg-gradient-to-br from-[var(--primary-color)] to-[#11111f] opacity-90"></div>
            <div class="absolute top-1/4 left-1/4 w-72 h-72 bg-[var(--accent-color)] rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
            <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-pink-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>

            <div class="z-10 text-center max-w-4xl space-y-8">
                <p class="text-xl text-zinc-400 animated-hero">— Your Foundation for Digital Growth</p>
                <!-- Updated to SI-Web -->
                <h1 class="6xl sm:text-7xl lg:text-9xl font-extrabold text-white leading-tight animated-hero">
                    SI-<span class="text-[var(--accent-color)] block md:inline-block">WEB</span>
                </h1>
                
                <!-- Typing Indicator Text Area -->
                <div class="h-10 text-2xl font-semibold text-zinc-300 animated-hero mx-auto max-w-full overflow-hidden">
                    <span id="typewriter-text" class="border-r-2 border-zinc-300 pr-1"></span>
                </div>

                <button id="hero-quote-button" class="mt-8 py-3 px-10 text-lg bg-white text-[var(--primary-color)] font-extrabold rounded-lg shadow-xl hover:bg-[var(--accent-color)] hover:text-white transition-default transform hover:scale-105 animated-hero">
                    Launch Your Project — Get Instant Quote
                </button>
            </div>
        </section>

        <!-- My Work Section -->
        <section id="work" class="py-20 lg:py-32 px-6">
            <div class="container mx-auto">
                <h2 class="text-4xl lg:text-5xl font-extrabold text-center mb-16 text-white">My Work</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">

                    <!-- Project 1: Second Hand Cell (IFRAME SNAPSHOT) -->
                    <a href="https://secondhandcell.com" target="_blank" class="block group rounded-xl overflow-hidden shadow-2xl bg-[#2a2a44] hover:shadow-[0_0_20px_rgba(0,210,255,0.4)] transition-default transform hover:-translate-y-2">
                        <div class="h-48 overflow-hidden relative">
                            <div class="iframe-container transition-default group-hover:scale-110">
                                <iframe src="https://secondhandcell.com" class="iframe-snapshot" title="Second Hand Cell Preview"></iframe>
                                <div class="iframe-overlay"></div> <!-- Invisible overlay for non-interactivity -->
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-white group-hover:text-[var(--accent-color)] transition-default">Second Hand Cell</h3>
                            <p class="text-zinc-400 text-sm mt-2">Mobile E-commerce Platform</p>
                            <span class="inline-flex items-center text-sm mt-4 text-[var(--accent-color)] group-hover:text-white transition-default">
                                Visit Site <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
                            </span>
                        </div>
                    </a>

                    <!-- Project 2: YDE Seniors (IFRAME SNAPSHOT) -->
                    <a href="https://ydeseniors.com" target="_blank" class="block group rounded-xl overflow-hidden shadow-2xl bg-[#2a2a44] hover:shadow-[0_0_20px_rgba(0,210,255,0.4)] transition-default transform hover:-translate-y-2">
                         <div class="h-48 overflow-hidden relative">
                            <div class="iframe-container transition-default group-hover:scale-110">
                                <iframe src="https://ydeseniors.com" class="iframe-snapshot" title="YDE Seniors Preview"></iframe>
                                <div class="iframe-overlay"></div> <!-- Invisible overlay for non-interactivity -->
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-white group-hover:text-[var(--accent-color)] transition-default">YDE Seniors</h3>
                            <p class="text-zinc-400 text-sm mt-2">Educational / School Portal</p>
                            <span class="inline-flex items-center text-sm mt-4 text-[var(--accent-color)] group-hover:text-white transition-default">
                                Visit Site <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
                            </span>
                        </div>
                    </a>

                    <!-- Project 3: Binyan Shalem (IFRAME SNAPSHOT) -->
                    <a href="https://binyan-shalem.com" target="_blank" class="block group rounded-xl overflow-hidden shadow-2xl bg-[#2a2a44] hover:shadow-[0_0_20px_rgba(0,210,255,0.4)] transition-default transform hover:-translate-y-2">
                        <div class="h-48 overflow-hidden relative">
                            <div class="iframe-container transition-default group-hover:scale-110">
                                <iframe src="https://binyan-shalem.com" class="iframe-snapshot" title="Binyan Shalem Preview"></iframe>
                                <div class="iframe-overlay"></div> <!-- Invisible overlay for non-interactivity -->
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-white group-hover:text-[var(--accent-color)] transition-default">Binyan Shalem</h3>
                            <p class="text-zinc-400 text-sm mt-2">Non-profit/Organizational Site</p>
                            <span class="inline-flex items-center text-sm mt-4 text-[var(--accent-color)] group-hover:text-white transition-default">
                                Visit Site <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
                            </span>
                        </div>
                    </a>

                    <!-- Project 4: Torat Yosef Raffle (IFRAME SNAPSHOT) -->
                    <a href="https://toratyosefsummerraffle.com" target="_blank" class="block group rounded-xl overflow-hidden shadow-2xl bg-[#2a2a44] hover:shadow-[0_0_20px_rgba(0,210,255,0.4)] transition-default transform hover:-translate-y-2">
                        <div class="h-48 overflow-hidden relative">
                            <div class="iframe-container transition-default group-hover:scale-110">
                                <iframe src="https://toratyosefsummerraffle.com" class="iframe-snapshot" title="Torat Yosef Raffle Preview"></iframe>
                                <div class="iframe-overlay"></div> <!-- Invisible overlay for non-interactivity -->
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-white group-hover:text-[var(--accent-color)] transition-default">Torat Yosef Raffle</h3>
                            <p class="text-zinc-400 text-sm mt-2">Fundraising/Raffle Site</p>
                            <span class="inline-flex items-center text-sm mt-4 text-[var(--accent-color)] group-hover:text-white transition-default">
                                Visit Site <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
                            </span>
                        </div>
                    </a>
                </div>
            </div>
        </section>        
        <!-- Contact Section -->
        <section id="contact" class="py-20 lg:py-32 px-6 bg-[#11111f] text-center">
            <div class="container mx-auto max-w-3xl">
                <h2 class="text-4xl lg:text-5xl font-extrabold mb-6 text-white">Ready to build something amazing?</h2>
                <p class="text-xl text-zinc-400 mb-10">
                    Your next high-performing website is just a quote away.
                </p>
                <button id="footer-quote-button" class="py-3 px-10 text-lg bg-[var(--accent-color)] text-[var(--primary-color)] font-extrabold rounded-lg shadow-xl hover:shadow-[0_0_20px_rgba(0,210,255,0.9)] transition-default transform hover:scale-105">
                    Start My Project Quote
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="py-8 text-center text-zinc-500 text-sm bg-black">
        <div class="container mx-auto flex justify-center items-center space-x-6">
            <span>&copy; 2025 SI-Web. Built with precision and passion.</span>
            <!-- ADMIN LINK -->
            <a href="admin.html" class="text-zinc-600 hover:text-[var(--accent-color)] transition-default flex items-center">
                <i data-lucide="lock" class="w-4 h-4 mr-1"></i> Admin
            </a>
        </div>
    </footer>

    <!-- Quote Generation Modal -->
    <div id="quote-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-50 flex justify-center items-start py-8 px-4 hidden modal-exit overflow-y-auto">
        <div class="bg-[var(--primary-color)] rounded-2xl shadow-2xl max-w-lg w-full p-6 sm:p-8 my-auto modal-content-box transition-default">
            
            <!-- Progress Bar (NEW) -->
            <div class="w-full bg-zinc-700 rounded-full h-2.5 mb-6 flex-shrink-0">
                <div id="quote-progress-bar" class="bg-[var(--accent-color)] h-2.5 rounded-full transition-all duration-500 ease-in-out" style="width: 0%;"></div>
            </div>
            
            <div class="flex justify-between items-center mb-6 border-b border-zinc-700 pb-4 flex-shrink-0">
                <h3 class="text-3xl font-bold text-white">Project Quote — Step <span id="current-step-display">1</span>/3</h3>
                <button id="close-quote-modal" class="text-zinc-400 hover:text-[var(--accent-color)] transition-default">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Quote Form Steps -->
            <form id="quote-form" class="space-y-0">
                
                <!-- This container holds all step content and is the only element that scrolls -->
                <div id="step-1-content" class="space-y-6">
                    
                    <!-- 1. Project Type (NEW) -->
                    <div>
                        <label class="block text-lg font-semibold mb-3 text-zinc-300">1. What is the primary purpose of your site?</label>
                        <div id="project-type-group" class="grid grid-cols-2 sm:grid-cols-3 gap-3 custom-radio">
                            <input type="radio" id="type-fundraiser" name="projectType" value="Fundraiser/Event" class="hidden">
                            <label for="type-fundraiser" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">Fundraiser/Event</label>

                            <input type="radio" id="type-shop" name="projectType" value="E-commerce/Shop" data-cost="300" class="hidden">
                            <label for="type-shop" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">Shop Site</label>

                            <input type="radio" id="type-portfolio" name="projectType" value="Portfolio/Brochure" class="hidden">
                            <label for="type-portfolio" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">Portfolio</label>

                            <input type="radio" id="type-info" name="projectType" value="Informational" class="hidden"> <!-- REMOVED DEFAULT CHECK -->
                            <label for="type-info" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">Informational</label>
                            
                            <input type="radio" id="type-custom" name="projectType" value="Custom App" data-cost="900" class="hidden">
                            <label for="type-custom" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">Custom App</label>
                        </div>
                    </div>


                    <!-- 2. Number of Pages (CLEAN LABELS) -->
                    <div>
                        <label class="block text-lg font-semibold mb-3 text-zinc-300">2. How many unique pages will your site require?</label>
                        <div id="pages-group" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 custom-radio">
                            <!-- 1 Page: $1,000 (BASE) -->
                            <input type="radio" id="pages-1" name="pages" value="1" data-cost="0" class="hidden"> <!-- REMOVED DEFAULT CHECK -->
                            <label for="pages-1" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">1 Page</label>

                            <!-- 3 Pages: $1,500 (+$500) -->
                            <input type="radio" id="pages-3" name="pages" value="3" data-cost="400" class="hidden">
                            <label for="pages-3" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">3 Pages</label>

                            <!-- 5 Pages: $2,500 (+$1500) -->
                            <input type="radio" id="pages-5" name="pages" value="5" data-cost="1000" class="hidden">
                            <label for="pages-5" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">5 Pages</label>

                            <!-- 7 Pages: $3,000 (+$2000) -->
                            <input type="radio" id="pages-7" name="pages" value="7" data-cost="1600" class="hidden">
                            <label for="pages-7" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">7 Pages</label>

                            <!-- 10+ Pages: $5,000 (+$4000) -->
                            <input type="radio" id="pages-10-plus" name="pages" value="10+" data-cost="2500" class="hidden">
                            <label for="pages-10-plus" class="p-3 text-sm rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)] flex items-center justify-center">10+ Pages</label>
                        </div>
                    </div>

                    <!-- 3. Backend/Database Requirement (WITH INFO BUTTON) -->
                    <div>
                        <div class="flex items-center mb-3">
                            <label class="block text-lg font-semibold text-zinc-300">3. Will you require a backend/database?</label>
                            <i data-lucide="help-circle" class="w-5 h-5 ml-2 cursor-pointer text-zinc-500 hover:text-white transition-colors" data-info-target="backend-info"></i>
                        </div>
                        <div id="backend-info" class="info-box hidden mt-2 p-3 text-sm rounded-lg bg-[#3a3a5e] text-zinc-200">
                            The backend is the brain of your website. It's needed for features like user logins, storing product data, saving form entries, or handling any dynamic content (content that changes based on user actions or time).
                        </div>
                        <div class="grid grid-cols-2 gap-3 custom-radio">
                            <input type="radio" id="backend-no" name="backend" value="no" data-cost="0" class="hidden"> <!-- REMOVED DEFAULT CHECK -->
                            <label for="backend-no" class="p-4 rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)]">No Backend (Static)</label>

                            <input type="radio" id="backend-yes" name="backend" value="yes" data-cost="1200" class="hidden">
                            <label for="backend-yes" class="p-4 rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)]">Yes, I need a Backend</label>
                        </div>
                    </div>

                    <!-- 4. Site Type / Key Features (WITH INFO BUTTONS) -->
                    <div>
                        <label class="block text-lg font-semibold mb-3 text-zinc-300">4. Select the key features needed:</label>
                        <div class="space-y-3">
                            <div class="flex flex-col">
                                <div class="flex items-center">
                                    <input type="checkbox" id="feature-ecommerce" name="feature-ecommerce" data-cost="900" class="w-5 h-5 accent-[var(--accent-color)] rounded">
                                    <label for="feature-ecommerce" class="ml-3 text-zinc-300">Store / Payment Gateway Integration</label>
                                    <i data-lucide="help-circle" class="w-5 h-5 ml-2 cursor-pointer text-zinc-500 hover:text-white transition-colors" data-info-target="ecommerce-info"></i>
                                </div>
                                <div id="ecommerce-info" class="info-box hidden mt-2 p-3 text-sm rounded-lg bg-[#3a3a5e] text-zinc-200">
                                    This covers setting up product listings, shopping carts, checkout logic, and connecting to services like PayPal or Stripe to securely accept payments.
                                </div>
                            </div>

                            <div class="flex flex-col">
                                <div class="flex items-center">
                                    <input type="checkbox" id="feature-admin" name="feature-admin" data-cost="450" class="w-5 h-5 accent-[var(--accent-color)] rounded">
                                    <label for="feature-admin" class="ml-3 text-zinc-300">Custom Admin/CMS Page</label>
                                    <i data-lucide="help-circle" class="w-5 h-5 ml-2 cursor-pointer text-zinc-500 hover:text-white transition-colors" data-info-target="admin-info"></i>
                                </div>
                                <div id="admin-info" class="info-box hidden mt-2 p-3 text-sm rounded-lg bg-[#3a3a5e] text-zinc-200">
                                    A Content Management System (CMS) or admin page lets you easily update text, change images, add blog posts, or modify products yourself without needing a developer for every little change.
                                </div>
                            </div>

                            <div class="flex flex-col">
                                <div class="flex items-center">
                                    <input type="checkbox" id="feature-support" name="feature-support" data-cost="280" class="w-5 h-5 accent-[var(--accent-color)] rounded">
                                    <label for="feature-support" class="ml-3 text-zinc-300">Customer Support / Live Chat Integration</label>
                                    <i data-lucide="help-circle" class="w-5 h-5 ml-2 cursor-pointer text-zinc-500 hover:text-white transition-colors" data-info-target="support-info"></i>
                                </div>
                                <div id="support-info" class="info-box hidden mt-2 p-3 text-sm rounded-lg bg-[#3a3a5e] text-zinc-200">
                                    Integrating a tool like Tidio, Zendesk, or a similar service to allow visitors to instantly chat with your team or send support requests directly from the website.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. Color Scheme (WITH INFO BUTTON) -->
                    <div>
                        <div class="flex items-center mb-3">
                            <label class="block text-lg font-semibold text-zinc-300">5. Do you have a defined color scheme?</label>
                            <i data-lucide="help-circle" class="w-5 h-5 ml-2 cursor-pointer text-zinc-500 hover:text-white transition-colors" data-info-target="color-info"></i>
                        </div>
                        <div class="grid grid-cols-2 gap-3 custom-radio">
                            <input type="radio" id="colors-yes" name="colors" value="yes" data-cost="0" class="hidden"> <!-- REMOVED DEFAULT CHECK -->
                            <label for="colors-yes" class="p-4 rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)]">Yes (Standard)</label>

                            <input type="radio" id="colors-custom" name="colors" value="custom" data-cost="200" class="hidden">
                            <label for="colors-custom" class="p-4 rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)]">Custom Branding/Color Audit</label>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Contact Information -->
                <div id="step-2-content" class="hidden space-y-4">
                    <p class="text-lg font-semibold text-zinc-300 mb-4">Please provide your contact information to receive the quote summary.</p>
                    
                    <div>
                        <label for="contact-name" class="block text-sm font-medium text-zinc-400 mb-1">Your Full Name (Required)</label>
                        <input type="text" id="contact-name" name="contact-name" required class="input-text w-full p-3 rounded-lg bg-[#2a2a44] border border-zinc-600 text-white placeholder-zinc-500 transition-default">
                    </div>
                    
                    <div>
                        <label for="contact-email" class="block text-sm font-medium text-zinc-400 mb-1">Email Address (Required)</label>
                        <input type="email" id="contact-email" name="contact-email" required class="input-text w-full p-3 rounded-lg bg-[#2a2a44] border border-zinc-600 text-white placeholder-zinc-500 transition-default">
                    </div>

                    <div>
                        <label for="contact-phone" class="block text-sm font-medium text-zinc-400 mb-1">Phone Number (10 Digits Required)</label>
                        <input type="tel" id="contact-phone" name="contact-phone" required pattern="\d{10}" title="Phone number must be exactly 10 digits" class="input-text w-full p-3 rounded-lg bg-[#2a2a44] border border-zinc-600 text-white placeholder-zinc-500 transition-default">
                    </div>
                </div>

                <!-- Step 3: Project Details -->
                <div id="step-3-content" class="hidden space-y-4">
                    <p class="text-lg font-semibold text-zinc-300 mb-4">Final project details.</p>
                    
                    <!-- 1. Project Name (REQUIRED) -->
                    <div>
                        <label for="project-name" class="block text-sm font-medium text-zinc-400 mb-1">Website Name/Business Name (Required)</label>
                        <input type="text" id="project-name" name="project-name" required class="input-text w-full p-3 rounded-lg bg-[#2a2a44] border border-zinc-600 text-white placeholder-zinc-500 transition-default">
                    </div>
                    
                    <!-- 2. Project URL (REQUIRED) -->
                    <div>
                        <label for="project-url" class="block text-sm font-medium text-zinc-400 mb-1">Intended/Existing URL (Required)</label>
                        <input type="url" id="project-url" name="project-url" required class="input-text w-full p-3 rounded-lg bg-[#2a2a44] border border-zinc-600 text-white placeholder-zinc-500 transition-default">
                    </div>

                    <!-- 3. URL Ownership Status (NEW, REQUIRED) -->
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-zinc-400 mb-2">URL Status (Domain Name Required)</label>
                        <div id="url-status-group" class="grid grid-cols-2 gap-3 custom-radio">
                            <input type="radio" id="url-owned" name="url-status" value="owned" data-cost="0" class="hidden">
                            <label for="url-owned" class="p-3 rounded-xl border-2 border-zinc-600 text-center cursor-pointer hover:border-[var(--accent-color)]">I own the domain.</label>
                            
                            <input type="radio" id="url-buy" name="url-status" value="buy" data-cost="0" class="hidden">
                            <label for="url-buy" class="p-3 rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)]">Need help acquiring it.</label>
                        </div>
                    </div>

                    <!-- 4. Project Description (NEW, REQUIRED) -->
                    <div class="mt-4">
                        <label for="project-description" class="block text-sm font-medium text-zinc-400 mb-1">Quick Site Description (Required)</label>
                        <textarea id="project-description" name="project-description" rows="3" required placeholder="E.g., A sleek, mobile-first portfolio site for my photography business with a secure client login area." class="input-text w-full p-3 rounded-lg bg-[#2a2a44] border border-zinc-600 text-white placeholder-zinc-500 transition-default"></textarea>
                    </div>

                    <!-- Existing Logo Status -->
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-zinc-400 mb-2">Do you have a company logo?</label>
                        <div class="grid grid-cols-2 gap-3 custom-radio">
                            <input type="radio" id="logo-yes" name="logo-status" value="yes" data-cost="0" class="hidden" checked>
                            <label for="logo-yes" class="p-3 rounded-xl border-2 border-zinc-600 text-center cursor-pointer hover:border-[var(--accent-color)]">Yes, I have one.</label>
                            
                            <!-- $100 for logo creation service, label is clean -->
                            <input type="radio" id="logo-no" name="logo-status" value="no" data-cost="250" class="hidden">
                            <label for="logo-no" class="p-3 rounded-xl border-2 border-zinc-600 text-center cursor-pointer transition-default hover:border-[var(--accent-color)]">No, create one</label>
                        </div>
                        <p class="text-xs text-zinc-500 mt-2">Note: This is an estimate for a basic design. Complex branding will require a custom quote. The logo creation service adds $100 to your total.</p>
                    </div>

                </div>

                <!-- Step Navigation and Quote Result -->
                <div class="mt-8 pt-6 border-t border-zinc-700 quote-footer">
                    <div id="navigation-buttons" class="flex justify-between items-center">
                        <button type="button" id="prev-step" class="py-2 px-4 bg-zinc-600 text-white font-bold rounded-lg transition-default hover:bg-zinc-500 hidden">
                            <i data-lucide="arrow-left" class="w-4 h-4 inline mr-2"></i> Back
                        </button>
                        
                        <div id="quote-price-preview" class="text-center">
                            <p class="text-lg font-medium text-zinc-300">Current Estimate:</p>
                            <p id="quote-result" class="text-4xl font-extrabold text-[var(--accent-color)] mt-1">$1,199</p>
                        </div>

                        <button type="button" id="next-step" class="py-2 px-4 bg-[var(--accent-color)] text-[var(--primary-color)] font-bold rounded-lg transition-default hover:bg-cyan-400">
                            Continue <i data-lucide="arrow-right" class="w-4 h-4 inline ml-2"></i>
                        </button>

                        <button type="submit" id="submit-quote" class="py-2 px-4 bg-green-500 text-[var(--primary-color)] font-bold rounded-lg transition-default hover:bg-green-400 hidden">
                            Submit Quote
                        </button>
                    </div>

                    <div id="submission-status" class="hidden text-center mt-6 p-4 rounded-lg bg-[#3a3a5e]">
                        <p id="status-message" class="text-xl font-bold text-white mb-2"></p>
                        <p id="final-price-display" class="text-4xl font-extrabold text-[var(--accent-color)] mb-4"></p>
                        <p id="disclaimer-text" class="text-sm text-zinc-400">
                            <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-1 text-yellow-500"></i>
                            This is an ESTIMATE. The final price may fluctuate based on detailed scope requests, content readiness, and unforeseen technical complexity. We will contact you shortly to confirm the details.
                        </p>
                    </div>
                </div>

            </form>
        </div>
    </div>

    <!-- Firebase SDK Imports (MUST use type="module") -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- ADDED: ENABLE FIREBASE DEBUG LOGGING ---
        setLogLevel('debug'); 

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Use provided config with fallback for safety
        const userProvidedConfig = {
            apiKey: "AIzaSyCcUMZmKwdOcUj4KszvTkPKlo-HmiVCXZU",
            authDomain: "setton-source-68177.firebaseapp.com",
            projectId: "setton-source-68177",
            storageBucket: "setton-source-68177.firebasestorage.app",
            messagingSenderId: "153708206059",
            appId: "1:153708206059:web:14cc935233eee4ecdb72bae",
            measurementId: "G-YW9WN4489T"
        };
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : userProvidedConfig;


        // Initialize Firebase
        let app, auth, db, userId;

        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // --- REVISED AUTH LOGIC FOR ROBUSTNESS using onAuthStateChanged ---
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    try {
                        // Attempt anonymous sign-in if no user is found
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Authentication failed during initialization or fallback:", error);
                    }
                }
                
                // Set userId after successful sign-in or attempt
                userId = auth.currentUser?.uid || 'anonymous-user';
                console.log("Firebase Auth Ready. User ID:", userId);
            });
            // --- END REVISED AUTH LOGIC ---

        } catch (e) {
            console.error("Firebase initialization error:", e);
        }

        // ------------------
        // DOM Elements and State
        // ------------------
        const quoteModal = document.getElementById('quote-modal');
        const openButtons = document.querySelectorAll('#open-quote-modal, #hero-quote-button, #footer-quote-button');
        const closeButton = document.getElementById('close-quote-modal');
        const quoteForm = document.getElementById('quote-form');
        const quoteResult = document.getElementById('quote-result');
        const stepDisplay = document.getElementById('current-step-display');
        const prevStepBtn = document.getElementById('prev-step');
        const nextStepBtn = document.getElementById('next-step');
        const submitQuoteBtn = document.getElementById('submit-quote');
        const statusDiv = document.getElementById('submission-status');
        const statusMessage = document.getElementById('status-message');
        const finalPriceDisplay = document.getElementById('final-price-display');
        const pricePreview = document.getElementById('quote-price-preview');
        const progressBar = document.getElementById('quote-progress-bar');
        
        // NEW ELEMENTS for validation targeting
        const projectTypeGroup = document.getElementById('project-type-group'); // NEW
        const pagesGroup = document.getElementById('pages-group');
        const urlStatusGroup = document.getElementById('url-status-group');
        const disclaimerText = document.getElementById('disclaimer-text');


        const stepContents = [
            document.getElementById('step-1-content'),
            document.getElementById('step-2-content'),
            document.getElementById('step-3-content')
        ];
        let currentStep = 0; // 0-indexed

        // Base Price for a simple 1-page static site is $1000
        const BASE_PRICE = 1199; // Premium base price

        // ------------------
        // 1. Header Scroll Logic (Kept from previous version)
        // ------------------
        const header = document.getElementById('main-header');
        const scrollThreshold = 50;

        function updateHeader() {
            if (window.scrollY > scrollThreshold) {
                header.classList.add('header-scrolled');
            } else {
                header.classList.remove('header-scrolled');
            }
        }

        window.addEventListener('scroll', updateHeader);
        updateHeader();

        // ------------------
        // 2. Typing Indicator Logic (Kept from previous version)
        // ------------------
        const typewriterTextElement = document.getElementById('typewriter-text');
        const phrases = [
            "Architecting High-Impact Web Solutions.",
            "Designing Sleek, Modern Portfolios.",
            "Building Complex E-commerce Platforms.",
            "SI-Web: Your Digital Foundation."
        ];
        let phraseIndex = 0;
        let charIndex = 0;
        let isDeleting = false;

        function typeWriter() {
            const currentPhrase = phrases[phraseIndex];
            let displayText = currentPhrase;

            if (isDeleting) {
                displayText = currentPhrase.substring(0, charIndex - 1);
                charIndex--;
            } else {
                displayText = currentPhrase.substring(0, charIndex + 1);
                charIndex++;
            }

            typewriterTextElement.textContent = displayText;

            let typingSpeed = 70;
            
            if (isDeleting) {
                typingSpeed = 30;
            }

            if (!isDeleting && charIndex === currentPhrase.length) {
                typingSpeed = 2000;
                isDeleting = true;
            } else if (isDeleting && charIndex === 0) {
                isDeleting = false;
                phraseIndex = (phraseIndex + 1) % phrases.length;
                typingSpeed = 500;
            }

            setTimeout(typeWriter, typingSpeed);
        }
        
        setTimeout(typeWriter, 1000); 
        
        // ------------------
        // 3. Quote Modal & Step Logic
        // ------------------
        
        // Helper function for non-validation related alerts (like Firebase errors)
        function alertUser(message, color) {
            statusDiv.classList.remove('hidden');
            // Remove all existing background colors
            statusDiv.classList.remove('bg-green-600/50', 'bg-yellow-600/50', 'bg-red-600/50', 'bg-[#3a3a5e]'); 
            // Apply error background
            statusDiv.classList.add(color === 'red' ? 'bg-red-600/50' : 'bg-yellow-600/50');
            statusMessage.textContent = message;
            finalPriceDisplay.textContent = '';
            
            // Hide the legal disclaimer during error alerts
            disclaimerText.classList.add('hidden'); 
            
            setTimeout(() => { 
                statusDiv.classList.add('hidden');
                // Re-enable disclaimer for the next time submission-status is used for success
                disclaimerText.classList.remove('hidden'); 
            }, 3000);
        }

        function updateStepDisplay() {
            // Hide all step content, then show the current one
            stepContents.forEach((step, index) => {
                step.classList.add('hidden');
                if (index === currentStep) {
                    step.classList.remove('hidden');
                }
            });

            // Update header text (1/3, 2/3, 3/3)
            stepDisplay.textContent = currentStep + 1;
            
            // Update progress bar
            const progress = ((currentStep + 1) / stepContents.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Handle navigation buttons visibility
            prevStepBtn.classList.toggle('hidden', currentStep === 0);
            nextStepBtn.classList.toggle('hidden', currentStep === stepContents.length - 1);
            submitQuoteBtn.classList.toggle('hidden', currentStep !== stepContents.length - 1);
            pricePreview.classList.toggle('hidden', currentStep === stepContents.length - 1);
            
            // Recalculate quote to update preview
            calculateQuote();
            // Clear status message when navigating steps
            statusDiv.classList.add('hidden');
        }
        
        function validateStep(stepIndex) {
            let isValid = true;
            let firstInvalidElement = null;

            // Helper to remove all error styles
            const removeErrors = () => {
                // Remove input text errors
                quoteForm.querySelectorAll('.input-text').forEach(el => el.classList.remove('input-error'));
                // Remove group container errors
                [projectTypeGroup, pagesGroup, urlStatusGroup].forEach(el => el && el.classList.remove('error-group-border'));
                
                // Get the elements containing the radio button groups for Q3 and Q5 by looking for their closest wrapper div.grid
                const backendGroup = document.getElementById('backend-no')?.closest('div.grid');
                const colorsGroup = document.getElementById('colors-yes')?.closest('div.grid');
                if (backendGroup) backendGroup.classList.remove('error-group-border');
                if (colorsGroup) colorsGroup.classList.remove('error-group-border');
            };
            
            // Clear all existing error styles at the start
            removeErrors();
            
            // Clear submission status message if visible
            statusDiv.classList.add('hidden');


            if (stepIndex === 0) { // Step 1: Site Requirements
                const projectTypeSelected = quoteForm.querySelector('input[name="projectType"]:checked'); // NEW Check
                const pagesSelected = quoteForm.querySelector('input[name="pages"]:checked');
                const backendSelected = quoteForm.querySelector('input[name="backend"]:checked'); // Q3 Check
                const colorsSelected = quoteForm.querySelector('input[name="colors"]:checked'); // Q5 Check
                
                // Get radio group wrappers for validation highlighting
                const backendGroup = document.getElementById('backend-no').closest('div.grid');
                const colorsGroup = document.getElementById('colors-yes').closest('div.grid');
                
                // 1. Project Type check
                if (!projectTypeSelected) {
                    isValid = false;
                    projectTypeGroup.classList.add('error-group-border');
                    if (!firstInvalidElement) firstInvalidElement = projectTypeGroup;
                }
                
                // 2. Pages check
                if (!pagesSelected) {
                    isValid = false;
                    if (!firstInvalidElement) firstInvalidElement = pagesGroup;
                    pagesGroup.classList.add('error-group-border');
                }
                
                // 3. Backend check
                if (!backendSelected) {
                    isValid = false;
                    if (!firstInvalidElement) firstInvalidElement = backendGroup;
                    backendGroup.classList.add('error-group-border');
                }
                
                // 5. Color Scheme check
                if (!colorsSelected) {
                    isValid = false;
                    if (!firstInvalidElement) firstInvalidElement = colorsGroup;
                    colorsGroup.classList.add('error-group-border');
                }
            }

            if (stepIndex === 1) { // Step 2: Contact Information
                const nameInput = document.getElementById('contact-name');
                const emailInput = document.getElementById('contact-email');
                const phoneInput = document.getElementById('contact-phone');
                const phoneRegex = /^\d{10}$/; // Exactly 10 digits
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                // 1. Name
                if (!nameInput.value) {
                    isValid = false;
                    nameInput.classList.add('input-error');
                    if (!firstInvalidElement) firstInvalidElement = nameInput;
                }
                // 2. Email
                if (!emailInput.value || !emailRegex.test(emailInput.value)) {
                    isValid = false;
                    emailInput.classList.add('input-error');
                    if (!firstInvalidElement) firstInvalidElement = emailInput;
                }
                // 3. Phone (length 10)
                if (!phoneInput.value || !phoneRegex.test(phoneInput.value)) {
                    isValid = false;
                    phoneInput.classList.add('input-error');
                    if (!firstInvalidElement) firstInvalidElement = phoneInput;
                }
            }
            
            if (stepIndex === 2) { // Step 3: Project Details
                const projectNameInput = document.getElementById('project-name');
                const projectUrlInput = document.getElementById('project-url');
                const projectDescriptionTextarea = document.getElementById('project-description');
                const urlStatusSelected = quoteForm.querySelector('input[name="url-status"]:checked');
                
                // 1. Project Name (required)
                if (!projectNameInput.value) {
                    isValid = false;
                    projectNameInput.classList.add('input-error');
                    if (!firstInvalidElement) firstInvalidElement = projectNameInput;
                }
                
                // 2. Project URL (required, basic check)
                if (!projectUrlInput.value) {
                    isValid = false;
                    projectUrlInput.classList.add('input-error');
                    if (!firstInvalidElement) firstInvalidElement = projectUrlInput;
                }
                
                // 3. Project Description (required)
                if (!projectDescriptionTextarea.value) {
                    isValid = false;
                    projectDescriptionTextarea.classList.add('input-error');
                    if (!firstInvalidElement) firstInvalidElement = projectDescriptionTextarea;
                }

                // 4. URL Status (required)
                if (!urlStatusSelected) {
                    isValid = false;
                    urlStatusGroup.classList.add('error-group-border');
                    if (!firstInvalidElement) firstInvalidElement = urlStatusGroup;
                }
            }
            
            if (!isValid && firstInvalidElement) {
                // Focus on the first invalid element if validation failed
                firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // If it's an input/textarea, focus it
                if (firstInvalidElement.tagName === 'INPUT' || firstInvalidElement.tagName === 'TEXTAREA') {
                     firstInvalidElement.focus(); 
                }
            }
            
            return isValid;
        }

        function changeStep(direction) {
            const nextStep = currentStep + direction;
            
            if (direction > 0 && currentStep < stepContents.length - 1) {
                if (!validateStep(currentStep)) return;
            }

            if (nextStep >= 0 && nextStep < stepContents.length) {
                currentStep = nextStep;
                updateStepDisplay();
            }
        }


        prevStepBtn.addEventListener('click', () => changeStep(-1));
        nextStepBtn.addEventListener('click', () => changeStep(1));

        // Modal Open/Close Logic (with digital spawn animation)
        function openModal() {
            currentStep = 0; // Reset to step 1 on open
            updateStepDisplay();
            statusDiv.classList.add('hidden');
            quoteModal.classList.remove('hidden', 'modal-exit-active');
            quoteModal.classList.add('flex', 'modal-enter');
            setTimeout(() => {
                quoteModal.classList.remove('modal-enter');
                quoteModal.classList.add('modal-enter-active');
            }, 10);
            document.body.style.overflow = 'hidden';
            calculateQuote();
        }

        function closeModal() {
            quoteModal.classList.remove('modal-enter-active');
            quoteModal.classList.add('modal-exit-active');
            setTimeout(() => {
                quoteModal.classList.add('hidden');
                quoteModal.classList.remove('flex');
                document.body.style.overflow = '';
            }, 300);
        }

        openButtons.forEach(button => {
            button.addEventListener('click', openModal);
        });
        closeButton.addEventListener('click', closeModal);
        quoteModal.addEventListener('click', (e) => {
            if (e.target.id === 'quote-modal') {
                closeModal();
            }
        });

        // ------------------
        // 4. Quote Calculation and Submission Logic
        // ------------------
        function calculateQuote() {
            let totalCost = BASE_PRICE;

            // Get all radio/checkbox inputs from all steps
            const inputs = quoteForm.querySelectorAll('input[type="radio"], input[type="checkbox"]');

            inputs.forEach(input => {
                const cost = parseInt(input.getAttribute('data-cost') || '0', 10);

                if (input.type === 'radio' && input.checked) {
                    // Cost is added for page count, backend, colors, logo status, and PROJECT TYPE
                    if (['projectType', 'pages', 'backend', 'colors', 'logo-status'].includes(input.name)) {
                        totalCost += cost;
                    }
                } else if (input.type === 'checkbox' && input.checked) {
                    // Cost is added for feature checkboxes
                    totalCost += cost;
                }
            });

            // Format the result as currency
            const formatter = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            });

            const formattedCost = formatter.format(totalCost);
            quoteResult.textContent = formattedCost;
            return { raw: totalCost, formatted: formattedCost };
        }

        async function submitQuote(e) {
            e.preventDefault();
            
            // Final step validation
            if (!validateStep(currentStep)) return;
            
            // Check if userId is available (authentication complete)
            if (!db || !userId) {
                alertUser('System is not authenticated. Please wait a moment and try again.', 'red');
                return;
            }

            const quoteData = {};
            const cost = calculateQuote();

            // 1. Gather Quote Details (Step 1)
            const step1Fields = quoteForm.querySelectorAll('#step-1-content input[type="radio"]:checked, #step-1-content input[type="checkbox"]:checked');
            step1Fields.forEach(input => {
                quoteData[input.name] = input.value;
            });

            // 2. Gather Contact Details (Step 2)
            quoteData.name = document.getElementById('contact-name').value;
            quoteData.email = document.getElementById('contact-email').value;
            quoteData.phone = document.getElementById('contact-phone').value;

            // 3. Gather Project Details (Step 3)
            quoteData.projectName = document.getElementById('project-name').value;
            quoteData.projectUrl = document.getElementById('project-url').value;
            quoteData.urlStatus = quoteForm.querySelector('input[name="url-status"]:checked')?.value || 'N/A';
            quoteData.projectDescription = document.getElementById('project-description').value;
            quoteData.logoStatus = quoteForm.querySelector('input[name="logo-status"]:checked').value;
            
            // 4. Add Final Price and Metadata
            quoteData.finalEstimate = cost.raw;
            quoteData.formattedEstimate = cost.formatted; // Add formatted value for easier debugging/display
            quoteData.timestamp = new Date().toISOString();
            quoteData.userId = userId;

            // Show loading message
            submitQuoteBtn.disabled = true;
            submitQuoteBtn.textContent = 'Submitting...';
            statusDiv.classList.add('hidden');

            try {
                // Write to public collection using 'quotes' instead of 'artifacts'
                const collectionPath = `quotes/${appId}/public/data/quotes`;
                const docRef = await addDoc(collection(db, collectionPath), quoteData);
                
                // Success
                console.log(`Firestore Write Success: Document written with ID: ${docRef.id} to collection: ${collectionPath}`);
                statusMessage.textContent = 'Quote Submitted Successfully!';
                finalPriceDisplay.textContent = `Final Estimate: ${cost.formatted}`;
                statusDiv.classList.remove('hidden');
                statusDiv.classList.remove('bg-yellow-600/50', 'bg-red-600/50');
                statusDiv.classList.add('bg-green-600/50');
                
                // Ensure disclaimer is visible on SUCCESS
                disclaimerText.classList.remove('hidden');
                
            } catch (error) {
                console.error("Error writing document to Firestore: ", error);
                alertUser('Submission Failed (Database Error). Please try again.', 'red');
            } finally {
                submitQuoteBtn.disabled = false;
                submitQuoteBtn.textContent = 'Submit Quote';
            }
        }

        // Attach event listeners
        quoteForm.addEventListener('change', calculateQuote);
        quoteForm.addEventListener('submit', submitQuote);

        // ------------------
        // 5. Info Toggle Logic 
        // ------------------
        function setupInfoToggles() {
            // Attach listener to all elements with the info-target attribute
            document.querySelectorAll('[data-info-target]').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    // Ensure the click targets the actual <i> element or its close ancestor
                    const targetElement = e.currentTarget; 

                    const targetId = targetElement.getAttribute('data-info-target');
                    const infoBox = document.getElementById(targetId);

                    if (infoBox) {
                        // Hide all other info boxes
                        document.querySelectorAll('.info-box').forEach(box => {
                            if (box.id !== targetId) {
                                box.classList.add('hidden');
                            }
                        });
                        // Toggle the clicked one
                        infoBox.classList.toggle('hidden');
                    }
                });
            });
        }
        
        // --- Secret Code Logic (H A N N A H) ---
        const SECRET_CODE = ['h', 'a', 'n', 'n', 'a', 'h'];
        let keyPressHistory = [];

        document.addEventListener('keydown', (e) => {
            // Check if focus is outside of an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return; 
            }
            
            const key = e.key.toLowerCase();
            
            if (key.length === 1 && key.match(/[a-z]/)) {
                keyPressHistory.push(key);
                
                // Keep history limited to the length of the secret code
                if (keyPressHistory.length > SECRET_CODE.length) {
                    keyPressHistory.shift();
                }
                
                // Check for the match
                if (keyPressHistory.length === SECRET_CODE.length && keyPressHistory.every((val, index) => val === SECRET_CODE[index])) {
                    console.log("Secret Admin Code Activated! Redirecting...");
                    keyPressHistory = []; 
                    window.location.href = 'admin.html';
                }
            } else {
                // If a non-alphabetic key is pressed, reset the sequence
                keyPressHistory = [];
            }
        });
        
        // --- Consolidated DOMContentLoaded Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Initialize Lucide Icons (must run first)
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // 2. Setup Info Toggles (Now that icons are rendered)
            setupInfoToggles();

            // 3. Initial calculation
            calculateQuote();
        });
    </script>
</body>
</html>
